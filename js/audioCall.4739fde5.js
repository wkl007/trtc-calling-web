(self.webpackChunktrtc_calling_web=self.webpackChunktrtc_calling_web||[]).push([[660],{3946:function(e,t,n){"use strict";n.d(t,{Z:function(){return I}});var r=n(5393),a=(0,r.withScopeId)("data-v-65341631");(0,r.pushScopeId)("data-v-65341631");var o={class:"call-form"},u=(0,r.createTextVNode)(" 呼叫中... "),c=(0,r.createTextVNode)(" 取消 "),i=(0,r.createTextVNode)(" 呼叫 ");(0,r.popScopeId)();var l=a((function(e,t,n,l,s,d){var p=(0,r.resolveComponent)("a-input"),f=(0,r.resolveComponent)("a-form-item"),m=(0,r.resolveComponent)("a-button"),v=(0,r.resolveComponent)("a-space"),g=(0,r.resolveComponent)("a-form");return(0,r.openBlock)(),(0,r.createBlock)("div",o,[(0,r.createVNode)(g,{layout:"horizontal","label-col":e.labelCol,"wrapper-col":e.wrapperCol,model:e.form,onSubmit:e.handleSubmit},{default:a((function(){return[(0,r.createVNode)(f,(0,r.mergeProps)({label:"呼叫方"},e.validateInfos.username),{default:a((function(){return[(0,r.createVNode)(p,(0,r.mergeProps)(e.inputProps,{placeholder:"呼叫方userId",size:"large",value:e.form.username,"onUpdate:value":t[1]||(t[1]=function(t){return e.form.username=t})}),null,16,["value"])]})),_:1},16),(0,r.createVNode)(f,{"wrapper-col":{span:20,offset:4}},{default:a((function(){return["calling"===e.trtcInfo.callStatus&&e.trtcInfo.isInviter?((0,r.openBlock)(),(0,r.createBlock)(v,{key:0,size:"large"},{default:a((function(){return[(0,r.createVNode)(m,{type:"primary",disabled:"",size:"large"},{default:a((function(){return[u]})),_:1}),(0,r.createVNode)(m,{size:"large",onClick:e.handleCancel},{default:a((function(){return[c]})),_:1},8,["onClick"])]})),_:1})):((0,r.openBlock)(),(0,r.createBlock)(m,{key:1,type:"primary","html-type":"submit",size:"large"},{default:a((function(){return[i]})),_:1}))]})),_:1})]})),_:1},8,["label-col","wrapper-col","model","onSubmit"])])})),s=(n(5412),n(1446)),d=(n(5666),n(7171)),p=n(9438),f=n(2119),m=n(6564),v=n(3407),g=(0,r.defineComponent)({name:"CallForm",setup:function(e,t){var n=t.emit,a=((0,f.tv)(),(0,m.oR)()),o=(0,r.inject)("images"),u=(0,r.computed)((function(){return a.getters.userInfo})),c=(0,r.computed)((function(){return a.getters.trtcInfo})),i=(0,r.reactive)({username:""}),l=(0,r.reactive)({username:[{required:!0,message:"请输入呼叫方userId"}]}),g=(0,v.cI)(i,l),I=g.validate,h=g.validateInfos;function C(){return(C=(0,d.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I();case 3:if(i.username!==u.value.username){e.next=6;break}return s.Z.error("不能输入当前登录userId"),e.abrupt("return");case 6:n("submit",i),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}return{labelCol:{span:4},wrapperCol:{span:20},inputProps:p.Wy,form:i,validateInfos:h,trtcInfo:c,images:o,handleSubmit:function(){return C.apply(this,arguments)},handleCancel:function(){n("cancel")}}}});g.render=l,g.__scopeId="data-v-65341631";var I=g},4389:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var r=n(5393),a=(0,r.withScopeId)("data-v-1cfd4d31");(0,r.pushScopeId)("data-v-1cfd4d31");var o={class:"audio-call"},u=(0,r.createVNode)("p",{class:"title"},"语音通话",-1),c={key:1,class:"audio-area"},i=(0,r.createVNode)("p",{class:"area-title"},"语音通话区域",-1),l={class:"audio-list"},s={class:"status-area"},d={class:"audio-username"},p={class:"operation-wrapper"},f=(0,r.createTextVNode)(" 挂断 ");(0,r.popScopeId)();var m=a((function(e,t,n,m,v,g){var I=(0,r.resolveComponent)("call-form"),h=(0,r.resolveComponent)("a-button"),C=(0,r.resolveComponent)("a-space");return(0,r.openBlock)(),(0,r.createBlock)("div",o,[u,"connected"!==e.trtcInfo.callStatus?((0,r.openBlock)(),(0,r.createBlock)(I,{key:0,onSubmit:e.handleCallUser,onCancel:e.handleCancelCallUser},null,8,["onSubmit","onCancel"])):(0,r.createCommentVNode)("",!0),"connected"===e.trtcInfo.callStatus&&e.showAudioCall?((0,r.openBlock)(),(0,r.createBlock)("div",c,[i,(0,r.createVNode)("div",l,[((0,r.openBlock)(!0),(0,r.createBlock)(r.Fragment,null,(0,r.renderList)(e.trtcInfo.meetingUserIdList,(function(t,n){return(0,r.openBlock)(),(0,r.createBlock)("div",{class:"audio-item",key:n},[(0,r.createVNode)("div",s,[(0,r.createVNode)("div",{class:"audio-status",style:{backgroundImage:"url(".concat(e.isUserMute(e.trtcInfo.muteAudioUserIdList,t)?e.images.micOff:e.images.micOn,")")}},null,4)]),(0,r.createVNode)("div",d,(0,r.toDisplayString)(t)+(0,r.toDisplayString)(t===e.userInfo.username?"(本人)":""),1)])})),128))]),(0,r.createVNode)("div",p,[(0,r.createVNode)(C,{size:"large"},{default:a((function(){return[(0,r.createVNode)(h,{type:"primary",size:"large",onClick:e.toggleAudioStatus},{default:a((function(){return[(0,r.createTextVNode)((0,r.toDisplayString)(e.isAudioOn?"关闭麦克风":"打开麦克风"),1)]})),_:1},8,["onClick"]),(0,r.createVNode)(h,{type:"danger",size:"large",onClick:e.handleHangup},{default:a((function(){return[f]})),_:1},8,["onClick"])]})),_:1})])])):(0,r.createCommentVNode)("",!0)])})),v=(n(7327),n(2772),n(5666),n(7171)),g=n(6564),I=n(35),h=n.n(I),C=n(3946),k=(0,r.defineComponent)({name:"AudioCall",components:{CallForm:C.Z},setup:function(){var e=(0,g.oR)(),t=(0,r.inject)("images"),n=(0,r.computed)((function(){return e.getters.trtcInfo})),a=(0,r.computed)((function(){return e.getters.userInfo})),o=(0,r.toRaw)((0,r.computed)((function(){return e.getters.trtcCalling})).value),u=(0,r.ref)(!1),c=(0,r.ref)(!0);function i(){return(i=(0,v.Z)(regeneratorRuntime.mark((function t(r){var u,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=n.value,c=a.value.username,t.next=4,o.call({userID:r.username,type:h().CALL_TYPE.AUDIO_CALL,timeout:30});case 4:return u.callStatus="calling",u.isInviter=!0,u.meetingUserIdList.indexOf(c)<0&&u.meetingUserIdList.push(c),t.next=9,e.dispatch("setTrtcInfo",u);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function l(){return(l=(0,v.Z)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.value,t.next=3,o.hangup();case 3:return r.callStatus="idle",r.meetingUserIdList=[],r.muteVideoUserIdList=[],r.muteAudioUserIdList=[],t.next=9,e.dispatch("setTrtcInfo",r);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function s(){u.value=!0}function d(){return(d=(0,v.Z)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.value,t.next=3,o.hangup();case 3:return u.value=!1,r.callStatus="idle",t.next=7,e.dispatch("setTrtcInfo",r);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(){return(p=(0,v.Z)(regeneratorRuntime.mark((function t(){var r,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.value,u=a.value.username,c.value=!c.value,o.setMicMute(!c.value),c.value?r.muteAudioUserIdList=r.muteAudioUserIdList.filter((function(e){return e!==u})):r.muteAudioUserIdList.push(u),t.next=7,e.dispatch("setTrtcInfo",r);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return(0,r.watch)((function(){return n.value.callStatus}),(function(e,t){e!==t&&"connected"===e&&s()})),(0,r.onMounted)((function(){var e=n.value;"connected"!==e.callStatus||e.isInviter||s()})),(0,r.onBeforeUnmount)((function(){var t=n.value;t.muteVideoUserIdList=[],t.muteAudioUserIdList=[],"connected"===t.callStatus&&(o.hangup(),t.callStatus="idle"),e.dispatch("setTrtcInfo",t)})),{images:t,trtcInfo:n,userInfo:a,showAudioCall:u,isAudioOn:c,handleCallUser:function(e){return i.apply(this,arguments)},handleCancelCallUser:function(){return l.apply(this,arguments)},toggleAudioStatus:function(){return p.apply(this,arguments)},handleHangup:function(){return d.apply(this,arguments)},isUserMute:function(e,t){return-1!==e.indexOf(t)}}}});k.render=m,k.__scopeId="data-v-1cfd4d31";var y=k}}]);